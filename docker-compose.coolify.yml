############################################################
# STREAMSIDE LIVEKIT - PRODUCTION SAFE CONFIG
############################################################
# This config uses network_mode: host for:
# 1. Best WebRTC performance (no Docker NAT overhead)
# 2. No port mapping issues (avoids Docker spawning processes)
# 3. Simple and stable deployment
#
# COOLIFY ENV VARS REQUIRED:
# - LIVEKIT_API_KEY    (e.g., APIStreamside)
# - LIVEKIT_API_SECRET (your secret)
#
# FIREWALL: Open ports 7880, 7881, 3478, 50000-50020/udp
############################################################

services:
  livekit:
    image: livekit/livekit-server:latest
    container_name: livekit-server
    restart: unless-stopped
    network_mode: host
    environment:
      LIVEKIT_CONFIG: |
        port: 7880
        bind_addresses:
          - "0.0.0.0"
        rtc:
          port_range_start: 50000
          port_range_end: 50100
          use_external_ip: true
          tcp_port: 7881
        turn:
          enabled: true
          udp_port: 3478
        keys:
          ${LIVEKIT_API_KEY}: ${LIVEKIT_API_SECRET}
        room:
          auto_create: true
          empty_timeout: 300
          max_participants: 80
        logging:
          level: info
    deploy:
      resources:
        limits:
          cpus: '8'
          memory: 16G
        reservations:
          cpus: '4'
          memory: 8G
