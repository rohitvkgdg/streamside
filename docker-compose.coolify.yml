version: '3.9'

# =============================================================================
# STREAMSIDE LIVEKIT - FOR COOLIFY
# =============================================================================
# Copy-paste this into Coolify Docker Compose service
# No external files needed - everything is configured via command args
#
# ENVIRONMENT VARIABLES TO SET IN COOLIFY:
# - LIVEKIT_API_KEY     (e.g., APIStreamside)
# - LIVEKIT_API_SECRET  (generate with: openssl rand -base64 32 | tr -d '/+=' | head -c 32)
#
# FIREWALL PORTS TO OPEN:
# - 7880/tcp, 7881/tcp, 3478/udp, 50000-60000/udp
# =============================================================================

services:
  livekit:
    image: livekit/livekit-server:latest
    container_name: livekit-server
    restart: unless-stopped
    network_mode: host
    command: >
      --bind 0.0.0.0
      --port 7880
      --rtc.port-range-start 50000
      --rtc.port-range-end 60000
      --rtc.tcp-port 7881
      --rtc.use-external-ip
      --turn.enabled
      --turn.udp-port 3478
      --room.auto-create
      --room.empty-timeout 300s
      --room.max-participants 50
      --keys "${LIVEKIT_API_KEY}:${LIVEKIT_API_SECRET}"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:7880/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

