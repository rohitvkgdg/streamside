version: '3.9'

# =============================================================================
# STREAMSIDE LIVEKIT - FOR COOLIFY
# =============================================================================
# SETUP STEPS:
# 1. SSH to your server and create config: mkdir -p /opt/livekit
# 2. Copy livekit.prod.yaml content to /opt/livekit/config.yaml
# 3. Set LIVEKIT_KEYS in Coolify (format: APIStreamside:your-secret)
# 4. Open ports: 7880,7881/tcp and 3478,50000-60000/udp
# =============================================================================

services:
  livekit:
    image: livekit/livekit-server:latest
    container_name: livekit-server
    restart: unless-stopped
    network_mode: host
    volumes:
      - /opt/livekit/config.yaml:/config.yaml:ro
    environment:
      - LIVEKIT_KEYS=${LIVEKIT_KEYS}
    command: ["--config", "/config.yaml"]
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:7880/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
